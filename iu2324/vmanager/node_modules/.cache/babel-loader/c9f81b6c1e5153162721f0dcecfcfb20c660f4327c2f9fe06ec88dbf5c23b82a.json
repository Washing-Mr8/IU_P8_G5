{"ast":null,"code":"import VModal from './VModal.vue';\nimport RangeBox from './RangeBox.vue';\nimport TextBox from './TextBox.vue';\nimport IpBox from './IpBox.vue';\nimport MemberBox from './MemberBox.vue';\nimport SelectBox from './SelectBox.vue';\nimport * as M from '../model.js';\nimport { ref } from 'vue';\nexport default {\n  __name: 'VmAddOrEditModal',\n  props: {\n    vm: Object,\n    isAdd: Boolean // otherwise, editing existing instead of adding\n  },\n\n  emits: ['add', 'edit'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const emit = __emit;\n    const props = __props;\n    let modalRef = ref(null);\n    function setVm() {\n      const vm = props.vm;\n      const form = document.getElementById(\"editOrAddVm\");\n      const valueFor = name => {\n        const input = form.querySelector(`input[name=${name}]`);\n        if (!input) console.log(\"ERROR: no input for name\", name, \"in\", form);\n        return input.value;\n      };\n      console.log(\"saving VM...\", vm, form);\n\n      // valida IP de forma manual\n      for (let i = 0; i < 4; i++) {\n        let input = form.querySelector(`input[name=e-ip-${i}]`);\n        let o = input.value;\n        input.setCustomValidity(o >= 0 && o < 255 ? \"\" : \"Expected an integer between 0 and 255\");\n      }\n      const ip = [0, 1, 2, 3].map(n => valueFor(`e-ip-${n}`)).join(\".\");\n\n      // comprueba validez de todos los campos, y sobreescribe resultado\n      if (!form.checkValidity()) {\n        // fuerza a que se muestren los errores simulando un envío\n        // (pero como hay errores, no se va a enviar nada :-)\n        form.querySelector(\"button[type=submit]\").click();\n        return;\n      }\n\n      // todo válido: lanza evento a padre, y cierra modal\n      emit(props.isAdd ? 'add' : 'edit', new M.Vm(vm.id, valueFor(\"e-name\"), valueFor(\"e-ram\"), valueFor(\"e-hdd\"), valueFor(\"e-cpu\"), valueFor(\"e-cores\"), ip, valueFor(\"e-up\"), valueFor(\"e-down\"), +valueFor(\"e-iso\"), M.VmState.STOPPED, vm.disk, vm.memory, JSON.parse(valueFor(\"e-groups\"))));\n      modalRef.value.hide();\n    }\n\n    // para que el padre pueda llamar a show (hide no debería hacer falta)\n    function show() {\n      modalRef.value.show();\n    }\n    __expose({\n      show\n    });\n    const __returned__ = {\n      emit,\n      props,\n      get modalRef() {\n        return modalRef;\n      },\n      set modalRef(v) {\n        modalRef = v;\n      },\n      setVm,\n      show,\n      VModal,\n      RangeBox,\n      TextBox,\n      IpBox,\n      MemberBox,\n      SelectBox,\n      get M() {\n        return M;\n      },\n      ref\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["VModal","RangeBox","TextBox","IpBox","MemberBox","SelectBox","M","ref","emit","__emit","props","__props","modalRef","setVm","vm","form","document","getElementById","valueFor","name","input","querySelector","console","log","value","i","o","setCustomValidity","ip","map","n","join","checkValidity","click","isAdd","Vm","id","VmState","STOPPED","disk","memory","JSON","parse","hide","show","__expose"],"sources":["C:/hlocal/IU_P8_G5/IU_P8_G5/iu2324/vmanager/src/components/VmAddOrEditModal.vue"],"sourcesContent":["<script setup>\r\n\r\nimport VModal from './VModal.vue'\r\nimport RangeBox from './RangeBox.vue'\r\nimport TextBox from './TextBox.vue'\r\nimport IpBox from './IpBox.vue'\r\nimport MemberBox from './MemberBox.vue'\r\nimport SelectBox from './SelectBox.vue'\r\n\r\nimport * as M from '../model.js'\r\nimport { ref } from 'vue'\r\n\r\nconst emit = defineEmits(['add', 'edit'])\r\n\r\nconst props = defineProps({\r\n  vm: Object,\r\n  isAdd: Boolean, // otherwise, editing existing instead of adding\r\n})\r\n\r\nlet modalRef = ref(null);\r\n\r\nfunction setVm() {\r\n  const vm = props.vm;\r\n  const form = document.getElementById(\"editOrAddVm\")\r\n  const valueFor = (name) => {\r\n    const input = form.querySelector(`input[name=${name}]`)\r\n    if (!input) console.log(\"ERROR: no input for name\", name, \"in\", form)\r\n    return input.value\r\n  }\r\n\r\n  console.log(\"saving VM...\", vm, form)\r\n\r\n  // valida IP de forma manual\r\n  for (let i = 0; i < 4; i++) {\r\n    let input = form.querySelector(`input[name=e-ip-${i}]`)\r\n    let o = input.value\r\n    input.setCustomValidity(o >= 0 && o < 255 ? \"\" : \"Expected an integer between 0 and 255\")\r\n  }\r\n  const ip = [0, 1, 2, 3].map(n => valueFor(`e-ip-${n}`)).join(\".\")\r\n\r\n  // comprueba validez de todos los campos, y sobreescribe resultado\r\n  if ( ! form.checkValidity()) {\r\n    // fuerza a que se muestren los errores simulando un envío\r\n    // (pero como hay errores, no se va a enviar nada :-)\r\n    form.querySelector(\"button[type=submit]\").click()\r\n    return; \r\n  }    \r\n\r\n  // todo válido: lanza evento a padre, y cierra modal\r\n  emit(props.isAdd ? 'add' : 'edit', new M.Vm(vm.id,\r\n    valueFor(\"e-name\"),\r\n    valueFor(\"e-ram\"), valueFor(\"e-hdd\"),\r\n    valueFor(\"e-cpu\"), valueFor(\"e-cores\"),\r\n    ip,\r\n    valueFor(\"e-up\"), valueFor(\"e-down\"),\r\n    +valueFor(\"e-iso\"), M.VmState.STOPPED, vm.disk, vm.memory, \r\n    JSON.parse(valueFor(\"e-groups\"))\r\n  ))\r\n  modalRef.value.hide()    \r\n}\r\n\r\n// para que el padre pueda llamar a show (hide no debería hacer falta)\r\nfunction show() {\r\n  modalRef.value.show();\r\n}\r\ndefineExpose({ show });\r\n</script>\r\n\r\n<template>\r\n  <VModal ref=\"modalRef\" id=\"vmAddOrEditModal\"\r\n    :title=\"isAdd ? 'Añadiendo VM' : `Editando VM: ${vm.name}`\" >\r\n    <template #body>\r\n      <form id=\"editOrAddVm\" \r\n        @submit.prevent=\"e => setVm()\">\r\n        <div class=\"container\">\r\n          <TextBox :start=\"vm.name\" id=\"e-name\" label=\"nombre\" />\r\n          <MemberBox :start=\"vm.groups\" :all=\"M.getGroups()\" id=\"e-groups\" label=\"grupos\" />\r\n          <br>\r\n          <RangeBox :start=\"vm.ram\" id=\"e-ram\" label=\"ram\" :min=\"0\" :max=\"128\" >\r\n          <span class=\"units\">Gb</span>\r\n          </RangeBox>\r\n          <RangeBox :start=\"vm.hd\" id=\"e-hdd\" label=\"hdd\" :min=\"0\" :max=\"4 * 1024\" :step=\"256\" />\r\n          <RangeBox :start=\"vm.cpu\" id=\"e-cpu\" label=\"cpu\" :min=\"0\" :max=\"100\" units=\"%\" />\r\n          <RangeBox :start=\"vm.cores\" id=\"e-cores\" label=\"cores\" :min=\"1\" :max=\"8\" units=\"#\" />\r\n          <br>\r\n          <IpBox :start=\"vm.ip\" id=\"e-ip\" label=\"ip\" />\r\n          <RangeBox :start=\"vm.up\" id=\"e-up\" label=\"up\" :min=\"0\" :max=\"1024 * 20\" units=\"Kbps\" />\r\n          <RangeBox :start=\"vm.down\" id=\"e-down\" label=\"down\" :min=\"0\" :max=\"1024 * 20\" units=\"Kbps\" />\r\n          <br>\r\n          <SelectBox :start=\"vm.iso\" :all=\"M.getFiles()\" id=\"e-iso\" label=\"Fichero ISO\" />\r\n        </div>\r\n        <button type=\"submit\" class=\"invisible\">Submit</button>\r\n      </form>\r\n    </template>\r\n    <template #footer>\r\n      <button @click.prevent=\"() => setVm()\" class=\"btn btn-primary\">\r\n        {{ isAdd ? 'Añadir esta VM' : `Confirmar cambios a ${vm.name}` }}\r\n      </button>\r\n    </template>\r\n  </VModal>\r\n</template>\r\n\r\n<style scoped>\r\n    #e-ram {\r\n      display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-ram .range-box {\r\n      display: flex;\r\n  }\r\n    #e-ram .units {\r\n    margin-left: 5px; /* O el valor que prefieras */\r\n  }\r\n  #e-hdd {\r\n     display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-hdd .units {\r\n    margin-left: flex; /* O el valor que prefieras */\r\n  }\r\n  #e-cpu {\r\n      display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-cpu.units {\r\n    margin-left: flex; /* O el valor que prefieras */\r\n  }\r\n  #e-cores {\r\n    display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-cores.units {\r\n    margin-left: flex; /* O el valor que prefieras */\r\n  }\r\n  #e-up {\r\n    display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-up.units {\r\n    margin-left: flex; /* O el valor que prefieras */\r\n  }\r\n  #e-down{\r\n    display: flex;\r\n      align-items: center; /* Ajusta el margen derecho según sea necesario */\r\n    }\r\n    #e-down.units {\r\n    margin-left: flex; /* O el valor que prefieras */\r\n  }\r\n\r\n \r\n \r\n</style>\r\n"],"mappings":"AAEA,OAAOA,MAAM,MAAM,cAAc;AACjC,OAAOC,QAAQ,MAAM,gBAAgB;AACrC,OAAOC,OAAO,MAAM,eAAe;AACnC,OAAOC,KAAK,MAAM,aAAa;AAC/B,OAAOC,SAAS,MAAM,iBAAiB;AACvC,OAAOC,SAAS,MAAM,iBAAiB;AAEvC,OAAO,KAAKC,CAAC,MAAM,aAAa;AAChC,SAASC,GAAG,QAAQ,KAAK;;;;;;;;;;;;;IAEzB,MAAMC,IAAI,GAAGC,MAA4B;IAEzC,MAAMC,KAAK,GAAGC,OAGZ;IAEF,IAAIC,QAAQ,GAAGL,GAAG,CAAC,IAAI,CAAC;IAExB,SAASM,KAAKA,CAAA,EAAG;MACf,MAAMC,EAAE,GAAGJ,KAAK,CAACI,EAAE;MACnB,MAAMC,IAAI,GAAGC,QAAQ,CAACC,cAAc,CAAC,aAAa,CAAC;MACnD,MAAMC,QAAQ,GAAIC,IAAI,IAAK;QACzB,MAAMC,KAAK,GAAGL,IAAI,CAACM,aAAa,CAAE,cAAaF,IAAK,GAAE,CAAC;QACvD,IAAI,CAACC,KAAK,EAAEE,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEJ,IAAI,EAAE,IAAI,EAAEJ,IAAI,CAAC;QACrE,OAAOK,KAAK,CAACI,KAAK;MACpB,CAAC;MAEDF,OAAO,CAACC,GAAG,CAAC,cAAc,EAAET,EAAE,EAAEC,IAAI,CAAC;;MAErC;MACA,KAAK,IAAIU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAE;QAC1B,IAAIL,KAAK,GAAGL,IAAI,CAACM,aAAa,CAAE,mBAAkBI,CAAE,GAAE,CAAC;QACvD,IAAIC,CAAC,GAAGN,KAAK,CAACI,KAAK;QACnBJ,KAAK,CAACO,iBAAiB,CAACD,CAAC,IAAI,CAAC,IAAIA,CAAC,GAAG,GAAG,GAAG,EAAE,GAAG,uCAAuC,CAAC;MAC3F;MACA,MAAME,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAACC,GAAG,CAACC,CAAC,IAAIZ,QAAQ,CAAE,QAAOY,CAAE,EAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;;MAEjE;MACA,IAAK,CAAEhB,IAAI,CAACiB,aAAa,CAAC,CAAC,EAAE;QAC3B;QACA;QACAjB,IAAI,CAACM,aAAa,CAAC,qBAAqB,CAAC,CAACY,KAAK,CAAC,CAAC;QACjD;MACF;;MAEA;MACAzB,IAAI,CAACE,KAAK,CAACwB,KAAK,GAAG,KAAK,GAAG,MAAM,EAAE,IAAI5B,CAAC,CAAC6B,EAAE,CAACrB,EAAE,CAACsB,EAAE,EAC/ClB,QAAQ,CAAC,QAAQ,CAAC,EAClBA,QAAQ,CAAC,OAAO,CAAC,EAAEA,QAAQ,CAAC,OAAO,CAAC,EACpCA,QAAQ,CAAC,OAAO,CAAC,EAAEA,QAAQ,CAAC,SAAS,CAAC,EACtCU,EAAE,EACFV,QAAQ,CAAC,MAAM,CAAC,EAAEA,QAAQ,CAAC,QAAQ,CAAC,EACpC,CAACA,QAAQ,CAAC,OAAO,CAAC,EAAEZ,CAAC,CAAC+B,OAAO,CAACC,OAAO,EAAExB,EAAE,CAACyB,IAAI,EAAEzB,EAAE,CAAC0B,MAAM,EACzDC,IAAI,CAACC,KAAK,CAACxB,QAAQ,CAAC,UAAU,CAAC,CACjC,CAAC,CAAC;MACFN,QAAQ,CAACY,KAAK,CAACmB,IAAI,CAAC,CAAC;IACvB;;IAEA;IACA,SAASC,IAAIA,CAAA,EAAG;MACdhC,QAAQ,CAACY,KAAK,CAACoB,IAAI,CAAC,CAAC;IACvB;IACAC,QAAY,CAAC;MAAED;IAAK,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}